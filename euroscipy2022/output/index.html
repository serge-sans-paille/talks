<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Discover Pythran through 10 code samples</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="font.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress" data-transition-duration="150"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="discover-pythran-through-10-code-samples">Discover Pythran through 10 code samples</h1><p><strong>Serge &#xAB; sans paille &#xBB; Guelton</strong></p><p>Compiler Engineer / Wood Craft Lover</p><p><strong>EuroScipy &#x2014; 31st August 2022</strong></p></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="template-slide">#0 Template Slide</h1><pre class="highlight code Python"><span class="c1">#pythran export hello()</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">"hello world"</span><span class="p">)</span></pre><pre class="highlight code shell">$ pythran hello.py</pre></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="from-scipy-s-hypotests-pythran-py">#1 From <a href="https://github.com/scipy/scipy/blob/main/scipy/stats/_hypotests_pythran.py">scipy's _hypotests_pythran.py</a></h1><pre class="highlight code Python"><span class="c1">#pythran export _Aij(float[:,:], int, int)</span>
<span class="c1">#pythran export _Aij(int[:,:], int, int)</span>
<span class="k">def</span> <span class="nf">_Aij</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
  <span class="sd">"""Sum of upper-left and lower right blocks of
     contingency table."""</span>
  <span class="c1"># See `somersd` References [2] bottom of page 309</span>
  <span class="k">return</span> <span class="n">A</span><span class="p">[:</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></pre></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="from-pyfiberamp-s-inner-loop-functions-py">#2 From <a href="https://github.com/Jomiri/pyfiberamp/blob/master/pyfiberamp/dynamic/inner_loop_functions.py">pyfiberamp's inner_loop_functions.py</a></h1><pre class="highlight code Python"><span class="c1">#pythran export apply_reflection(float[][], int[], int[], float[],</span>
<span class="c1">#                                int)</span>
<span class="k">def</span> <span class="nf">apply_reflection</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">source_idx</span><span class="p">,</span> <span class="n">target_idx</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">n_forward</span><span class="p">):</span>
  <span class="sd">"""Modifies `P` in-place."""</span>
  <span class="k">for</span> <span class="n">_source_idx</span><span class="p">,</span> <span class="n">_target_idx</span><span class="p">,</span> <span class="n">_R</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">source_idx</span><span class="p">,</span>
                                          <span class="n">target_idx</span><span class="p">,</span>
                                          <span class="n">R</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">_source_idx</span> <span class="o">&lt;</span> <span class="n">n_forward</span><span class="p">:</span>
      <span class="n">P</span><span class="p">[</span><span class="n">_target_idx</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_R</span> <span class="o">*</span> <span class="n">P</span><span class="p">[</span><span class="n">_source_idx</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">P</span><span class="p">[</span><span class="n">_target_idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_R</span> <span class="o">*</span> <span class="n">P</span><span class="p">[</span><span class="n">_source_idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></pre></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="from-handtracking-s-transforms-py">#3 From <a href="https://github.com/gianpy15/HandTracking/blob/997bcd834f20f9bfdf2053f29e5484c84441c98a/source/library/geometry/ptran/transforms.py">HandTracking's transforms.py</a></h1><pre class="highlight code Python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="o">...</span>

<span class="c1">#pythran export get_rotation_angle_around_axis(float[],</span>
<span class="c1">#                                              float[],</span>
<span class="c1">#                                              float[])</span>
<span class="k">def</span> <span class="nf">get_rotation_angle_around_axis</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
  <span class="n">v1</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">axis</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">axis</span><span class="p">))</span>
  <span class="n">v2</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">p2</span> <span class="o">-</span> <span class="n">axis</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">axis</span><span class="p">))</span>
  <span class="n">cross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">cross</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>
  <span class="o">...</span></pre></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="from-spectraldns-s-pythran-maths-py">#4 From <a href="https://github.com/spectralDNS/spectralDNS/blob/master/spectralDNS/optimization/pythran_maths.py">spectralDNS's pythran_maths.py</a></h1><pre class="highlight code Python"><span class="c1">#pythran export _mult_K1j(float64[:], float64[:],</span>
<span class="c1">#                         complex128[:, :, :], complex128[:, :, :, :])</span>
<span class="k">def</span> <span class="nf">_mult_K1j</span><span class="p">(</span><span class="n">Ky</span><span class="p">,</span> <span class="n">Kz</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
      <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">Kz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
        <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">Ky</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">f</span></pre></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="from-obvz-s-pythran-funcs-py">#5 From <a href="https://github.com/swhalemwo/obvz/blob/master/layout_optim/pythran_funcs.py">obvz's pythran_funcs.py</a></h1><pre class="highlight code Python"><span class="c1">#pythran export pythran_ovlp(float64[:,:])</span>
<span class="k">def</span> <span class="nf">pythran_ovlp</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
  <span class="n">nbr_nds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">nbr_pts</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="n">d</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>

  <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">shape</span>
  <span class="c1"># nrows/ncols : size of each cell -&gt; 2</span>
  <span class="n">nrows</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>

  <span class="n">res_ar</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="n">nrows</span><span class="p">),</span> <span class="n">nrows</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="p">)</span>
  <span class="o">...</span></pre></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="from-scikit-image-s-hessian-det-appx-pythran-py">#6 From <a href="https://github.com/scikit-image/scikit-image/blob/main/skimage/feature/_hessian_det_appx_pythran.py">scikit-image's _hessian_det_appx_pythran.py</a></h1><pre class="highlight code Python"><span class="c1">#pythran export _hessian_matrix_det(float64[:,:], float or int)</span>
<span class="k">def</span> <span class="nf">_hessian_matrix_det</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
  <span class="o">...</span>
  <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
  <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span>
  <span class="n">s2</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
  <span class="n">s3</span> <span class="o">=</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">3</span>
  <span class="n">l</span> <span class="o">=</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">3</span>
  <span class="n">w</span> <span class="o">=</span> <span class="n">size</span>
  <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
  <span class="n">w_i</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">size</span> <span class="o">/</span> <span class="n">size</span>
  <span class="o">...</span></pre></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="from-scikit-image-s-brief-pythran-py">#7 From <a href="https://github.com/scikit-image/scikit-image/blob/main/skimage/feature/brief_pythran.py">scikit-image's brief_pythran.py</a></h1><pre class="highlight code Python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1">#pythran export _brief_loop(float32[:,:] or float64[:,:], uint8[:,:],</span>
<span class="c1">#                           int64[:,2], int32[:,2], int32[:,2])</span>
<span class="k">def</span> <span class="nf">_brief_loop</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">descriptors</span><span class="p">,</span> <span class="n">keypoints</span><span class="p">,</span> <span class="n">pos0</span><span class="p">,</span> <span class="n">pos1</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">pr0</span><span class="p">,</span> <span class="n">pc0</span> <span class="o">=</span> <span class="n">pos0</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
    <span class="n">pr1</span><span class="p">,</span> <span class="n">pc1</span> <span class="o">=</span> <span class="n">pos1</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">keypoints</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
      <span class="n">kr</span><span class="p">,</span> <span class="n">kc</span> <span class="o">=</span> <span class="n">keypoints</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">image</span><span class="p">[</span><span class="n">kr</span> <span class="o">+</span> <span class="n">pr0</span><span class="p">,</span> <span class="n">kc</span> <span class="o">+</span> <span class="n">pc0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">[</span><span class="n">kr</span> <span class="o">+</span> <span class="n">pr1</span><span class="p">,</span> <span class="n">kc</span> <span class="o">+</span> <span class="n">pc1</span><span class="p">]:</span>
        <span class="n">descriptors</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span></pre></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="from-scipy-s-matfuncs-sqrtm-triu-py">#8 From <a href="https://github.com/scipy/scipy/blob/main/scipy/linalg/_matfuncs_sqrtm_triu.py">scipy's _matfuncs_sqrtm_triu.py</a></h1><pre class="highlight code Python"><span class="c1"># pythran export within_block_loop(float64[:,:], float64[:,:],</span>
<span class="c1">#                                  (int, int) list, intp)</span>
<span class="c1"># pythran export within_block_loop(complex128[:,:], complex128[:,:],</span>
<span class="c1">#                                  (int, int) list, intp)</span>

<span class="k">def</span> <span class="nf">within_block_loop</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">start_stop_pairs</span><span class="p">,</span> <span class="n">nblocks</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">start_stop_pairs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># s = R[i, i+1:j] @ R[i+1:j, j]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

        <span class="n">denom</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span>
        <span class="k">if</span> <span class="n">denom</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="k">elif</span> <span class="n">denom</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'failed to find the matrix square root'</span><span class="p">)</span></pre></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="from-scikit-image-s-setup-py">#9 From <a href="https://github.com/scikit-image/scikit-image/blob/main/setup.py">scikit-image's setup.py</a></h1><pre class="highlight code Python"><span class="kn">from</span> <span class="nn">numpy.distutils.command.build_ext</span> <span class="kn">import</span> <span class="n">build_ext</span> <span class="k">as</span> <span class="n">npy_build_ext</span>
<span class="c1"># ...</span>
<span class="kn">from</span> <span class="nn">pythran.dist</span> <span class="kn">import</span> <span class="n">PythranBuildExt</span> <span class="k">as</span> <span class="n">pythran_build_ext</span>
<span class="c1"># ...</span>

<span class="k">class</span> <span class="nc">ConditionalOpenMP</span><span class="p">(</span><span class="n">pythran_build_ext</span><span class="p">[</span><span class="n">npy_build_ext</span><span class="p">]):</span>

  <span class="k">def</span> <span class="nf">can_compile_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compile_flags</span><span class="p">,</span> <span class="n">link_flags</span><span class="p">):</span>
    <span class="o">...</span>

  <span class="k">def</span> <span class="nf">build_extensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ConditionalOpenMP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">build_extensions</span><span class="p">()</span></pre></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="from-scipy-s-meson-build">#10 From <a href="https://github.com/scipy/scipy/blob/main/scipy/optimize/meson.build">scipy's meson.build</a></h1><pre class="highlight code Python"><span class="k">if</span> <span class="n">use_pythran</span>
  <span class="n">_group_columns</span> <span class="o">=</span> <span class="n">custom_target</span><span class="p">(</span><span class="s1">'_group_columns'</span><span class="p">,</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s1">'_group_columns.cpp'</span><span class="p">],</span>
    <span class="nb">input</span><span class="p">:</span> <span class="s1">'_group_columns.py'</span><span class="p">,</span>
    <span class="n">command</span><span class="p">:</span> <span class="p">[</span><span class="n">pythran</span><span class="p">,</span> <span class="s1">'-E'</span><span class="p">,</span> <span class="s1">'@INPUT@'</span><span class="p">,</span> <span class="s1">'-o'</span><span class="p">,</span>
              <span class="s1">'@OUTDIR@/_group_columns.cpp'</span><span class="p">]</span>
  <span class="p">)</span>

  <span class="n">_group_columns</span> <span class="o">=</span> <span class="n">py3</span><span class="o">.</span><span class="n">extension_module</span><span class="p">(</span><span class="s1">'_group_columns'</span><span class="p">,</span>
    <span class="p">[</span><span class="n">_group_columns</span><span class="p">],</span>
    <span class="n">cpp_args</span><span class="p">:</span> <span class="p">[</span>
      <span class="s1">'-Wno-unused-function'</span><span class="p">,</span> <span class="s1">'-Wno-unused-variable'</span><span class="p">,</span>
      <span class="s1">'-Wno-deprecated-declarations'</span><span class="p">,</span>
      <span class="s1">'-Wno-cpp'</span><span class="p">,</span> <span class="s1">'-Wno-int-in-bool-context'</span>
    <span class="p">]</span> <span class="o">+</span> <span class="n">cpp_args_pythran</span><span class="p">,</span>
    <span class="n">include_directories</span><span class="p">:</span> <span class="p">[</span><span class="n">incdir_pythran</span><span class="p">,</span> <span class="n">incdir_numpy</span><span class="p">],</span>
    <span class="n">install</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="n">subdir</span><span class="p">:</span> <span class="s1">'scipy/optimize'</span>
  <span class="p">)</span></pre></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="concluding-words">Concluding Words</h1><ul><li>Documentation: <a href="https://pythran.readthedocs.io/">https://pythran.readthedocs.io/</a></li><li>PyPI: <a href="https://pypi.org/project/pythran/">https://pypi.org/project/pythran/</a></li><li>Github: <a href="https://github.com/serge-sans-paille/pythran">https://github.com/serge-sans-paille/pythran</a></li><li>IRC: #pythran on <a href="https://oftc.net">https://oftc.net</a></li><li>flame and praise: <a href="mailto:serge.guelton@telecom-bretagne.eu">serge.guelton@telecom-bretagne.eu</a></li></ul></div></div><div id="slide-number" class="slide-number">
         1
      </div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/gotoSlide.js"></script><script type="text/javascript" src="js/hovercraft.js"></script><script type="text/javascript">
      document.getElementById("impress").addEventListener("impress:stepenter", update_slide_number, false);
    </script></body></html>