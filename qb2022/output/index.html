<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>UniCode Review</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="font.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress" data-transition-duration="150"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="unicode-review">UniCode Review</h1><p><strong>Serge &#xAB; sans paille &#xBB; Guelton</strong></p><p>Compiler Engineer / Wood Craft Lover / RedHat employee</p><p><em>Friday'Con &#x2014; 25 March 2022</em></p><img src="goblin_tinkerer.jpg" width="400"></img></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="please">Please</h1><p>Read:</p><ul><li><a href="https://trojansource.codes/">https://trojansource.codes/</a></li><li><a href="https://certitude.consulting/blog/en/invisible-backdoor/">https://certitude.consulting/blog/en/invisible-backdoor/</a></li><li><a href="https://developers.redhat.com/articles/2022/01/12/prevent-trojan-source-attacks-gcc-12">https://developers.redhat.com/articles/2022/01/12/prevent-trojan-source-attacks-gcc-12</a></li><li><a href="https://unicode.org/reports/tr36/">https://unicode.org/reports/tr36/</a></li></ul></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="unicode">Unicode</h1><table cellpadding="0" cellspacing="0"><thead><tr><th><p>&#x178A;</p></th><th><p>&#x1F34;</p></th><th><p>&#xCA3;</p></th></tr></thead><tbody><tr><td><p>&#x27AB;</p></td><td><p>&#x271E;</p></td><td><p>&#x26AB;</p></td></tr><tr><td><p>&#x3070;</p></td><td><p>&#x4E91;</p></td><td><p>&#x416;</p></td></tr></tbody></table></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="but-also">But also</h1><p>Hangul filler, U+3164: <tt>&#x3164;</tt></p><p>Alveolar Click, U+01C3: <tt>&#x1C3;</tt></p><p>Zero-width Space, U+200B: <tt>&#x200B;</tt></p></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="unicode-properties">Unicode properties</h1><pre class="highlight code">[code];[name];[gc];[cc];[bc];[decomposition];;;[nv];[bm];[alias];;;;</pre><p>'bc' = bidi (bidirectional) category [L, R etc]</p><p>'bm' = bidi mirrored [N or Y]</p></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="u-0068"><tt>U+0068</tt></h1><pre class="highlight code">  Age                   1.1
  ASCII                 Yes
* Bidi_Class            Left_to_Right
* Bidi_Mirrored         No
  General_Category      Letter</pre><p>see also:</p><ul><li>cyrillic small letter shha U+04BB <tt>&#x4BB;</tt></li><li>planck constant: U+210E <tt>&#x210E;</tt></li></ul></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="u-0028"><tt>U+0028</tt></h1><pre class="highlight code">  Age                   1.1
  ASCII                 Yes
* Bidi_Class            Other_Neutral
* Bidi_Mirrored         Yes
* Bidi_Mirroring_Glyph  )
* Bidi_Paired_Bracket   )
  Block                 Basic_Latin
  General_Category      Open_Punctuation</pre></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="u-05d0"><tt>U+05D0</tt></h1><pre class="highlight code">  Age                   1.1
  ASCII                 No
* Bidi_Class            Right_to_Left
* Bidi_Mirrored         No
  General_Category      Letter</pre></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="boustrophedon">Boustrophedon</h1><pre class="highlight code">&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21B4;
&#x21B6;&#x2190;&#x2190;&#x2190;&#x2190;&#x2190;&#x2190;&#x2190;&#x2190;&#x2190;&#x21B5;
&#x21B3;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21D2;&#x21B4;
.&#x2190;&#x2190;&#x2190;&#x2190;&#x2190;&#x2190;&#x2190;&#x2190;&#x2190;&#x21B5;</pre></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="some-bidi-characters">Some Bidi characters</h1><table cellpadding="0" cellspacing="0"><thead><tr><th><p>Abbr.</p></th><th><p>Code Point</p></th><th><p>Description</p></th></tr></thead><tbody><tr><td><p>RLO</p></td><td><p>U+202E</p></td><td><p>Force following characters to be treated as strong right-to-left characters.</p></td></tr><tr><td><p>LRI</p></td><td><p>U+2066</p></td><td><p>Treat the following text as isolated and left-to-right.</p></td></tr><tr><td><p>PDI</p></td><td><p>U+2069</p></td><td><p>End the scope of the last LRI, RLI, or FSI.</p></td></tr></tbody></table></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="unicode-comment">UniCode Comment</h1><pre class="highlight code">/* &lt;U+0x202E&gt; } &lt;U+0x2066&gt; if (isAdmin) &lt;U+0x2069&gt; &lt;U+0x2066&gt; begin admins only */</pre><ol><li><strong>Display</strong> <tt>/*</tt></li><li><strong>Change ordering</strong> to <em>right-to-left</em></li><li><strong>Display</strong> <tt>}</tt> (from the right)</li><li><strong>Set ordering</strong> to <em>left-to-right</em></li><li><strong>Display</strong> <tt>if (isAdmin)</tt> (from the right)</li><li><strong>Pop</strong> state <tt>4.</tt></li><li><strong>Set ordering</strong> to <em>left-to-right</em></li><li><strong>Display</strong> <tt>begin admins only */</tt> (from the right)</li></ol><pre class="highlight code">/* begin admins only */ if (isAdmin) {</pre></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="bidi-algorithm">BiDi algorithm</h1><p>See <a href="http://www.unicode.org/reports/tr9">http://www.unicode.org/reports/tr9</a></p><p>Important notes:</p><ul><li>Applied a the scope of the paragraph</li><li>Tolerates the bidi stack to be non empty at the end of a paragraph</li></ul></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="detecting-invalid-bidi-0">Detecting invalid BiDi (0)</h1><p>Warn about Bidi characters in</p><ul><li>comments</li><li>string literals</li></ul></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="detecting-invalid-bidi-1">Detecting invalid BiDi (1)</h1><p>Invariant: before the closing <tt>*/</tt> we must be back to the initial state</p><p>Pros:</p><ul><li>Detect the <em>trojan source</em> attack</li><li>Anything can happen between <tt>/*</tt> and <tt>*/</tt></li></ul><p>Cons:</p><ul><li>Require to implement (part of) the BiDi logic in the compiler</li><li>Require to parse comments</li></ul></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="implementations">Implementations</h1><p>In GCC: <tt>-Wbidi-chars</tt>, see <a href="https://godbolt.org/z/MM3na11rj">https://godbolt.org/z/MM3na11rj</a></p><p>In clang: not supported</p><p>In clang-tidy:  <tt>misc-misleading-bidirectional</tt>, see <a href="https://github.com/llvm/llvm-project/blob/main/clang-tools-extra/test/clang-tidy/checkers/misc-misleading-bidirectional.cpp">github rendering</a></p></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="ordering-again">Ordering, again</h1><pre class="highlight code">&#x5D0; = &#x5D2;
;</pre><p>What's assigned to what?</p></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="detection">Detection</h1><p>In clang-tidy: misc-misleading-identifier</p></div><div class="step step-level-1" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="homoglyph-again">Homoglyph, again</h1><pre class="highlight code">&#x4BB; = 1
h = 2
print(&#x4BB;)</pre><p>What's printed?</p></div><div class="step step-level-1" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="id1">Detection</h1><p>RTFM: <a href="http://www.unicode.org/reports/tr39/#def-skeleton">http://www.unicode.org/reports/tr39/#def-skeleton</a></p><p>In gcc12: <tt>-Whomoglyph</tt></p><p>In clang-tidy: <a href="https://reviews.llvm.org/D112916">https://reviews.llvm.org/D112916</a></p></div><div class="step step-level-1" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="30400" data-y="0" data-z="0"><h1 id="ianal">IANAL</h1><p>I am Not a Linguist, but...</p><p>code &#x2260; text</p><p>compiler &#x2260; renderer</p></div><div class="step step-level-1" step="20" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="32000" data-y="0" data-z="0"><h1 id="security">&#x2665; Security &#x2665;</h1><ul><li>Not really a compiler vuln &#x1F512;</li><li>Scanning the whole RedHat codebase&#x2026; &#xF8;</li></ul><p><strong>But</strong></p><ul><li>An interesting task to work on &#x263A;</li><li>In vim: Ctrl+V u</li></ul></div></div><div id="slide-number" class="slide-number">
         1
      </div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/gotoSlide.js"></script><script type="text/javascript" src="js/hovercraft.js"></script><script type="text/javascript">
      document.getElementById("impress").addEventListener("impress:stepenter", update_slide_number, false);
    </script></body></html>