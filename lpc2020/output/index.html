<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Security Related Flags: a Common GCC/LLVM View</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="font.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress" data-transition-duration="150"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="intro">Intro</h1><p>Security countermeasure strikes at several level:</p><ul><li>hardware (buy a new machine)</li><li>microcode (update your kernel)</li><li><em>compiler</em> (pick compiler flags)</li><li>codebase (update your code)</li></ul></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="always-two-they-are">Always Two They Are</h1><p>GCC Toolchain (mostly gcc + ld.bfd)</p><p>LLVM Toolchain (mostly clang + lld)</p></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="security-related-flags-a-common-gcc-llvm-view">Security Related Flags: a Common GCC/LLVM View</h1><p><strong>Serge &#xAB; sans paille &#xBB; Guelton</strong></p><p>Compiler Engineer / Wood Craft Lover / RedHat employee</p><p><strong>LPC'20 &#x2014; 26th of August 2020</strong></p></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="common-library-overflows">Common Library Overflows</h1><p><em>Attack</em>: Exploit standard C/C++ functions misuse</p><p><em>Countermeasure</em>: Provide foritified version of these functions</p><p><em>Flag</em>: <tt>-D_FORITFY_SOURCE</tt> (gcc, clang for builtin supports), <tt>-D_GLIBCXX_ASSERTIONS</tt></p><p><em>Overhead</em>: low (fortify) to high (asserts)</p></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="common-code-overflows">Common Code Overflows</h1><p><em>Attack</em>: Exploit buffer overflow</p><p><em>Countermeasure</em>: Range analysis</p><p><em>Flag</em>: <tt>-Werror=array-bounds</tt> (gcc, clang)</p><p><em>Overhead</em>: nop (compile time)</p></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="common-formating-attacks">Common Formating Attacks</h1><p><em>Attack</em>: Exploit user-controlled formating arguments</p><p><em>Countermeasure</em>: Warn about dubious patterns</p><p><em>Flag</em>: <tt>-Werror=format-security</tt> (gcc, clang)</p><p><em>Overhead</em>: nop (compile time)</p></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="common-uninitialized-variables">Common Uninitialized Variables</h1><p><em>Attack</em>: Use unitialized variable to leak previous state</p><p><em>Coutermeasure</em>: Always initialize stack variable</p><p><em>Flag</em>: <tt>-ftrivial-auto-var-init=pattern</tt> (clang)</p><p><em>Overhead</em>: yes (?)</p></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="got-plt-overwrite">GOT / PLT Overwrite</h1><p><em>Attack</em>: Overwrite the GOT/PLT to overwrite executable sections</p><p><em>Countermeasure</em>: Mark GOT/PLT read-only</p><p><em>Flag</em>: <tt>-Wl,-z,norelro</tt> (ld.bfd, lld), <tt>-Wl,-z,lazy</tt> (ld.bfd, lld)</p><p><em>Overhead</em>: increased startup time</p></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="executable-stack">Executable Stack</h1><p><em>Attack</em>: Overwrite an executable stack with malicious code</p><p><em>Countermeasure</em>: Mark the stack as non-executable</p><p><em>Flag</em>: <tt>-Wl,-z,noexecstack</tt> (ld.bfd, lld)</p><p><em>Overhead</em>: nop (?)</p></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="security-through-diversity">Security through Diversity</h1><p><em>Attack</em>: Write reusable shellcodes / attacks</p><p><em>Countermeasure</em>: Randomize process adresses (ASLR)</p><p><em>Flag</em>: <tt>-pie -fPIE</tt> or <tt>-fPIC</tt> (gcc/ld.bfd, clang/lld)</p><p><em>Overhead</em>: increased startup time (?)</p></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="stack-clash">Stack Clash</h1><p><em>Attack</em>: Make the stack and the heap grow so that they overlap</p><p><em>Countermeasure</em>: Probe each page to trigger the kernel page guard</p><p><em>Flag</em>: <tt>-fstack-clash-protector</tt> (gcc, clang)</p><p><em>Overhead</em>: only for functions with large / dynamic stack alloc</p></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="stack-smash">Stack Smash</h1><p><em>Attack</em>: Modify the stack thanks to an overflow</p><p><em>Countermeasure</em>: Stack Canary</p><p><em>Flag</em>: <tt>-fstack-protector</tt> (gcc, clang)</p><p><em>Overhead</em>: one check per function, user-controlled granularity</p></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="spectre-v1">Spectre V1</h1><p><em>Attack</em>: Trick branch prediction into filling the cache with secret data</p><p><em>Countermeasure</em>: create a data dependency between data access and predicate state</p><p><em>Flag</em>: <tt>-mspeculative-load-hardening</tt> (clang)</p><p><em>Overhead</em>: non-neglectible (todo: add ref)</p></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="spectre-v2">Spectre V2</h1><p><em>Attack</em>: Trick branch prediction into executing a controlled function pointer</p><p><em>Countermeasure</em>: Use return prediction instead of branch prediction</p><p><em>Flag</em>: <tt>-mretpoline</tt> (clang) <tt>-mindirect-branch, -mfunction-return</tt> (gcc)</p><p><em>Overhead</em>: non-neglectible (todo: add ref)</p></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="return-oriented-programing">Return Oriented Programing</h1><p><em>Attack</em>: Execute arbitrary code through a chain of gadget</p><p><em>Countermeasure</em>: Check control flow integrity / Intel CET</p><p><em>Flag</em>: <tt>-fsanitize=cfi</tt> (clang) <tt>-mcet</tt> (clang, gcc) <tt>-fcf-protection</tt> (clang,
gcc)</p></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="certification">Certification</h1><p>Want to double-check the flags used in the build process?</p><ul><li><tt>-fplugin=annobin</tt> (gcc, clang)</li><li><tt>-grecord-gcc-switches</tt> (gcc)</li></ul></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="follow-ups">Follow-ups</h1><ul><li>Convergence of options names is ~OK</li><li>But beside names, implementation differ!<ul><li>Discussing implementation across mlist (or on a common medium?)</li><li>Sharing compiler-agnostic test beds?</li></ul></li></ul></div></div><div id="slide-number" class="slide-number">
        1
      </div><div id="hovercraft-help" class="hide"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>G</th><td>Go to slide number</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script><script type="text/javascript">
        document.getElementById("impress").addEventListener("impress:stepenter", update_slide_number, false);
      </script></body></html>