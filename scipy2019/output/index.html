<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Pythran, 6 years later</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="font.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></head><body class="impress-not-supported"><div id="impress" data-transition-duration="150"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="this-is-a-pythran-kernel">This is a Pythran Kernel</h1><p>Yup, it's plain Python</p><pre class="highlight code python"><span class="c1">#pythran export l1norm(float64[:,:], float64[:,:])</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">def</span> <span class="nf">l1norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></pre><p>And you compile it like this:</p><pre class="highlight code sh">&gt; pythran l1norm.py</pre><p>Running the generated native module yields a x6 speedup compared to CPython,</p><p><span class="math ">\(\times 9\)</span> when simd instructions are active.</p></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="pythran-6-years-ago">Pythran, 6 Years Ago</h1><p>First presented at Scipy 2013</p><p>Core Ideas:</p><ul><li>Ahead of time compiler</li><li>Embeded in Python: Pure Python + top-level type comments</li><li>Lazy evaluation of Numpy expression</li><li>Optimize high-level kernels, no-loops!</li><li>Support most Python functional aspects</li><li>Automatic vectorization</li><li>Explicit OpenMP parallel constructs</li><li>No Python mode</li></ul><p>Everything is still valid! That's a firm ground for a compiler.</p></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="pythran-6-years-later">Pythran, 6 Years Later</h1><p>Steady code growth, more users, more optimizations, more Numpy support:</p><ul><li>Python3 and Python2 Support</li><li>Linux, OSC and Windows Support</li><li>Conda integration</li><li>Support for C++ code generation</li><li>Efficient support for a large part of Numpy broadcasting</li><li>Many Numpy functions are implemented</li><li>Correct and efficient typing within is None tests</li><li>GIL-free code</li></ul></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="integrate-into-the-ecosystem">Integrate into the Ecosystem</h1><ul><li>Notebook integration: <tt>%%pythran cells</tt></li><li>Cython integration:  <tt>#cython: np_pythran=True</tt></li><li>Native function generation: <tt>#pythran export capsule</tt>...</li></ul></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="some-supported-kernels">Some Supported Kernels</h1><p>Local functions, numpy support, default parameters</p><pre class="highlight code python"><span class="c1">#pythran export evolve(float64[][], float)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">def</span> <span class="nf">laplacian</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">grid</span>

<span class="k">def</span> <span class="nf">evolve</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">grid</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">D</span> <span class="o">*</span> <span class="n">laplacian</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span></pre></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="id1">Some Supported Kernels</h1><p>Default parameters, keyword arguments, numpy expression, enumerate, tuples...</p><pre class="highlight code python"><span class="c1">#pythran export check_mask(bool[][])</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">def</span> <span class="nf">check_mask</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
        <span class="n">target</span><span class="p">,</span> <span class="n">vector</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">vector</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">out</span></pre></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="numbers-look-serious">Numbers Look Serious</h1><p>Number of commits:</p><pre class="highlight code sh">&gt; git rev-list --count <span class="m">0</span>.9.2
<span class="m">2834</span></pre><p>Number of Authors (some duplicate in there):</p><pre class="highlight code sh">&gt; git shortlog -s -n <span class="p">|</span> wc -l
<span class="m">39</span></pre><p>Number of closed Issues:</p><pre class="highlight code sh">&gt; curl -s https://github.com/serge-sans-paille/pythran/issues <span class="p">|</span> grep Closed
      <span class="m">361</span> Closed</pre></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="get-it">Get It</h1><ul><li>Source: <a href="https://github.com/serge-sans-paille/pythran">https://github.com/serge-sans-paille/pythran</a></li><li><dl><dt>Packages:</dt><dd><ul><li><a href="https://pypi.org/project/pythran">https://pypi.org/project/pythran</a></li><li><a href="https://anaconda.org/conda-forge/pythran">https://anaconda.org/conda-forge/pythran</a></li></ul></dd></dl></li><li>Doc: <a href="https://pythran.readthedocs.io">https://pythran.readthedocs.io</a></li><li>Air Speed Velocity: <a href="https://serge-sans-paille.github.io/pythran-asv/">https://serge-sans-paille.github.io/pythran-asv/</a></li><li>Blog: <a href="http://serge-sans-paille.github.io/pythran-stories/">http://serge-sans-paille.github.io/pythran-stories/</a></li><li><dl><dt>Contact:</dt><dd><ul><li><a href="https://www.freelists.org/list/pythran">https://www.freelists.org/list/pythran</a></li><li>#pythran on IRC, freenode</li></ul></dd></dl></li></ul></div></div><div id="slide-number" class="slide-number">
        1
      </div><div id="hovercraft-help" class="hide"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>G</th><td>Go to slide number</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script><script type="text/javascript">
        document.getElementById("impress").addEventListener("impress:stepenter", update_slide_number, false);
      </script></body></html>